*SINGLE ID MULTIPLE TRANSACTIONS;

*RFM ANALYSIS;

 

DATA SALES;

INPUT ID $ AMOUNT T_DATE DATE9. PRODUCT $;

DATALINES;
1001 200 11JAN2020  A
1001 120 3JAN2020  B
1001 150 7JAN2020  C
1001 220 12JAN2020 D
1002 120 13JAN2020  B
1003 150 7JAN2020  C
1004 220 22JAN2020 D
1002 120 30JAN2020  B
1003 150 27JAN2020  C
1002 220 11JAN2020 D
1004 120 30JAN2020  B
1003 150 17JAN2020  C
1002 220 22JAN2020 D
;

RUN;

PROC PRINT;RUN;

 

PROC SORT DATA = SALES OUT= SALES_01;

  BY ID DESCENDING T_DATE PRODUCT;

RUN;

PROC PRINT;RUN;

 

DATA SALE_SUMMARY;

  SET SALES_01;

  BY ID;

 

  IF FIRST.ID THEN TOTAL_AMT = 0;

   TOTAL_AMT +AMOUNT;

 

  IF FIRST.ID THEN NUM_TRANSACTION = 0;

   NUM_TRANSACTION+1;

 

   NEXT_DAY = LAG(T_DATE);

   DAY_DIFF = NEXT_DAY - T_DATE;

   IF FIRST.ID THEN DAY_DIFF = 0;

 

   RETAIN ALL_PRODUCT;

 

   IF FIRST.ID THEN ALL_PRODUCT = "           ";

    ALL_PRODUCT = CATX("," ,ALL_PRODUCT,PRODUCT);

 

RUN;

PROC PRINT;

FORMAT T_DATE NEXT_DAY DATE9.;

RUN;

 

PROC SQL;

CREATE TABLE SALE_DAY_MEAN AS

SELECT ID , AVG(DAY_DIFF) AS MEAN

FROM SALE_SUMMARY

GROUP BY ID

;

QUIT;

 

PROC PRINT DATA = SALE_DAY_MEAN;

RUN;

 

PROC SQL;

CREATE TABLE SALE_SUMMARY_01 AS

SELECT A.*,B.MEAN FORMAT 4.2

FROM SALE_SUMMARY AS A LEFT JOIN SALE_DAY_MEAN AS B

ON A.ID = B.ID

;

QUIT;

 

 

PROC PRINT;RUN;

 

 

DATA RFM;

SET SALE_SUMMARY_01 (RENAME=(MEAN= AVEARGE_DAYS));

BY ID;

KEEP ID NUM_TRANSACTION TOTAL_AMT AVEARGE_DAYS ALL_PRODUCT;

IF LAST.ID;

RUN;

 

PROC PRINT;RUN;
